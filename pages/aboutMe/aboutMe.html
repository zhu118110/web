<!Doctype html>
<html>

<head>
	<meta charset="utf-8">
	<title>关于我</title>
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
	<link href="../../css/mui.css" rel="stylesheet" />
	<link rel="stylesheet" type="text/css" href="../../css/public.css"/>
	<link rel="stylesheet" type="text/css" href="../../css/aboutMe/aboutMe.css"/>
	<link rel="stylesheet" type="text/css" href="../../fonts/font.css"/>
	<style type="text/css">
	</style>
</head>
<body id="body">
<div class="box">
	

		<!-- 侧滑导航根容器 -->
	<div class="mui-off-canvas-wrap" ref="wrap" >
		
		  <!-- 侧滑菜单 -->
		  <aside class="mui-off-canvas-left myaside" onclick="tz('.myaside')">
			  <!-- 侧滑头像 -->
			<header class="myaside_header">
				<div style="border-radius: 50%;overflow: hidden;">
					<img class="mui-media-object mui-pull-left" src="../../img/0.jpg">
				</div>
				<div class="mui-media-body">
					<p >{{userName}}</p>
				</div>
		    </header>
			<ul class="mui-table-view">
				
				<a href="#" data-url="myInfor/myInfor.html" data-id="myInfor.html">
					<li class="mui-table-view-cell">
						<span>
							编辑资料
						</span>
						<span class="iconfont icon-gerenxinxi"></span>
					</li>
				</a>
				<a href="#" data-url="address/my_address.html" data-id="my_address.html">
					<li class="mui-table-view-cell">
						<span>
							我的收货地址
						</span>
						<span class="iconfont icon-tianjiadizhi"></span>
					</li>
				</a>
			</ul>
			<ul class="mui-table-view">
				<a href="#">
					<li class="mui-table-view-cell">
						<span>
							音效与通知
						</span>
						<span class="iconfont icon-tongzhi"></span>
					</li>
				</a>
				<a href="#">
					<li class="mui-table-view-cell">
						<span>
							设置
						</span>
						<span class="iconfont icon-shezhi"></span>
					</li>
				</a>
				<a href="#">
					<li class="mui-table-view-cell">
						<span>
							关于我们
						</span>
						<span class="iconfont icon-guanyuwomen"></span>
					</li>
				</a>
			</ul>
			<ul class="mui-table-view">
				<a @click="toLogin()">
					<li class="mui-table-view-cell">
						退出登录
					</li>
				</a>
			</ul>
		  </aside>
		  
		  <!-- 主界面开始 -->
		<div class="mui-content mui-inner-wrap"> 
			
			<!-- w我的信息开始 -->
			<div class="my_infor"  @click="dragToggle()">
				<ul class="mui-table-view mui-table-view-chevron">
					<li class="mui-table-view-cell mui-media">
						<a class="mui-navigate-right mytx">
							<div style="border-radius: 50%;overflow: hidden;">
								<img class="mui-media-object mui-pull-left" :src="heade_img">
							</div>
							
							<div class="mui-media-body">
								<p style="color: #fff;">{{userName}}</p>
							</div>
						</a>
					</li>
				</ul>
			</div><!-- w我的信息结束 -->
			
				<!-- 我的订单开始 -->
			<div class="mui-card myCard" style="margin-top: 0;">
				<div class="mui-card-header my-card-header">
					<div>
						我的订单
					</div>
					<div>
						<a href="#"> 产看全部订单 > </a> 
					</div>
				</div>
				<div class="mui-card-content">
					<div class="mui-card-content-inner myCardContent">
						<ul>
							<a href="#">
								<li>
									<div class="iconfont icon-daifukuan"></div>
									<div>待付款</div>
								</li>
							</a>
							<a href="#">
								<li>
									<div class="iconfont icon-daifenxiang"></div>
									<div>待分享</div>
								</li>
							</a>
							<a href="#">
								<li>
									<div class="iconfont icon-dengdaifahuo"></div>
									<div>待发货</div>
								</li>
							</a>
							<a href="#">
								<li>
									<div class="iconfont icon-dengdaishouhuo"></div>
									<div>待收货</div>
								</li>
							</a>
							<a href="#">
								<li>
									<div class="iconfont icon-daipingjia-copy"></div>
									<div>待评价</div>
								</li>
							</a>
						</ul>
					</div>
				</div>
				
			</div><!-- 我的订单结束 -->
			
			<!-- 我的收藏开始 -->
			<div class="mui-card myCard mysc" >
				<div class="mui-card-content">
					<div class="mui-card-content-inner myCardContent">
						<ul id="mysc" onclick="tz('#mysc')">
							<a data-url="collect/my_collect.html" data-id="my_collect.html">
								<li>
									<div class="iconfont icon-youhuiquan"></div>
									<div>优惠券</div>
								</li>
							</a>
							<a data-url="collect/my_collect.html" data-id="my_collect.html">
								<li>
									<div class="iconfont icon-shangpinshoucang"></div>
									<div>商品收藏</div>
								</li>
							</a>
							<a data-url="collect/my_collect.html" data-id="my_collect.html">
								<li>
									<div class="iconfont icon-lishiliulan"></div>
									<div>历史浏览</div>
								</li>
							</a>
							<a data-url="collect/my_collect.html" data-id="my_collect.html">
								<li>
									<div class="iconfont icon-tuikuanshouhou"></div>
									<div>退款售后</div>
								</li>
							</a>
							<a data-url="collect/my_collect.html" data-id="my_collect.html">
								<li>
									<div class="iconfont icon-wodepingjia1"></div>
									<div>我的评价</div>
								</li>
							</a>
						</ul>
					</div>
				</div>
			</div><!-- 我的收藏结束-->
			
			<!-- 精选推荐 -->
			<div class="recommend" id="upLoad">
				<p>
					<span class="iconfont icon-tuijian"></span> 精选推荐
				</p>
				<ul class="mui-table-view my-table-view">
					<li class="mui-table-view-cell">
						<a href="#">
							<img class="" src="../../img/bd1.jpg">
							<div class="mui-media-body">
								<p>2020春夏新款运动裤女装宽松显瘦半袖宅女休闲瘦半袖宅女休闲</p>
								<ul class="price">
									<li>
										<span>￥</span><span>39.9</span>
									</li>
									<li><span>100人付款</span></li>
								</ul>
							</div>
							
						</a>
					</li>
					<li class="mui-table-view-cell">
						<a href="#">
							<img class="" src="../../img/bd2.jpg">
							<div class="mui-media-body">
								<p>2020春夏新款运动裤女装宽松显瘦半袖宅女休闲瘦半袖宅女休闲</p>
								<ul class="price">
									<li>
										<span>￥</span><span>39.9</span>
									</li>
									<li><span>100人付款</span></li>
								</ul>
							</div>
						</a>
					</li>
					<li class="mui-table-view-cell">
						<a href="#">
							<img class="" src="../../img/bd3.jpg">
							<div class="mui-media-body">
								<p>2020春夏新款运动裤女装宽松显瘦半袖宅女休闲瘦半袖宅女休闲</p>
								<ul class="price">
									<li>
										<span>￥</span><span>39.9</span>
									</li>
									<li><span>100人付款</span></li>
								</ul>
							</div>
						</a>
					</li>
					<li class="mui-table-view-cell">
						<a href="#">
							<img class="" src="../../img/bd4.jpg">
							<div class="mui-media-body">
								<p>2020春夏新款运动裤女装宽松显瘦半袖宅女休闲瘦半袖宅女休闲</p>
								<ul class="price">
									<li>
										<span>￥</span><span>39.9</span>
									</li>
									<li><span>100人付款</span></li>
								</ul>
								
							</div>
						</a>
					</li>
					<li class="mui-table-view-cell">
						<a href="#">
							<img class="" src="../../img/bd4.jpg">
							<div class="mui-media-body">
								<p>2020春夏新款运动裤女装宽松显瘦半袖宅女休闲瘦半袖宅女休闲</p>
								<ul class="price">
									<li>
										<span>￥</span><span>39.9</span>
									</li>
									<li><span>100人付款</span></li>
								</ul>
								
							</div>
						</a>
					</li>
					<li class="mui-table-view-cell">
						<a href="#">
							<img class="" src="../../img/bd4.jpg">
							<div class="mui-media-body">
								<p>2020春夏新款运动裤女装宽松显瘦半袖宅女休闲瘦半袖宅女休闲</p>
								<ul class="price">
									<li>
										<span>￥</span><span>39.9</span>
									</li>
									<li><span>100人付款</span></li>
								</ul>
								
							</div>
						</a>
					</li>
				</ul>
			</div>		
			<div class="mui-off-canvas-backdrop" style="box-shadow: none;"></div>
		</div> <!-- 主界面结束 -->
	</div><!-- 侧滑导航根容器 -->
 
</div>
</body>
<script src="../../js/mui.min.js"></script>
<script src="../../js/vue.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
	// 监听登录页面的back事件,刷新页面
	window.addEventListener('clearStorage',function(event){
	  var statu = event.detail.statu;   //  true|false
	  let current=plus.webview.currentWebview();
	   current.reload();//页面刷新 
	});
	
	function tz(ele){
		// 收藏列点击时，进行页面预加载，根据url和id跳转到不同页面,携带的参数是存在本地的用户id
		mui(ele).on('tap','a',function(){
			let url=this.getAttribute("data-url");
			let id=this.getAttribute("data-id");
			if(url,id){
				mui.plusReady(function () {
				    let userId=plus.storage.getItem("account");
					let prePage=mui.preload({
					    url,
					    id,
					    extras:{
							userId
						}
					});
					prePage.show()
					
					// mui.openWindow({
					// 	url,
					// 	id,
					// 	extras:{
					// 		userId
					// 	}
					// })
				})
			}
			
		})
	}
	
	// 阻止主页面滑动触发侧滑导航
	document.querySelector(".mui-inner-wrap").addEventListener("drag",function(){
		  event.stopPropagation();
	})

	const vue=new Vue({
		el:".box",
		data:{
			api:"http://192.168.88.69:3200",
			userName:"请先登录",
			heade_img:"../../img/0.jpg"
		},
		created() {
			this.getStorage()
		},
		mounted() {
			mui.init({
				keyEventBind: {  
					backbutton: false,  //Boolean(默认true)关闭back按键监听  
					menubutton: true   //Boolean(默认true)关闭menu按键监听  
				}  
			});
			
		},
		methods:{
			// 获取本地存储的用户id，
			// 请求后台查找到昵称
			getStorage(){
				let idValue;  
				let that=this;
				mui.plusReady(function () {
					// 得到存储的用户id的key,得到的是个数组
				  let idKey=plus.storage.getAllKeys();
				  // 通过key得到存储的用户id，，key必须是字符串
				  idValue=plus.storage.getItem(`${idKey}`);
				  // console.log(`key是${idKey},value是${idValue}`);
				  ajax(idValue)
				});
				// 根据用户的id请求后台，回去用户数据
				function ajax(id){
					mui.ajax(that.api+"/aboutMe",{
						data:{
							userId:id
						},
						type:"post",
						timeout:10000,
						success:function(data){
							if(data.data){
								let dataArr=[];
								dataArr.push(...[data.data])
								dataArr.forEach(val=>{
									that.userName=val.userName;  //用户名
									that.heade_img=val.headImg;   //用户头像
									// console.log("userName是"+that.userName)
								})
							}
						},
						error:function(xhr,type){
							mui.toast("获取用户名错误")
						}
					})
				}
				
			},
			
			// 点击退出登录跳转到登录页面
			// 清除本地存储的用户id
			toLogin(){
				mui.openWindow({
					url:"../login/login.html",
					id:"login.html",
				});
				mui.plusReady(function(){
					//退出登录时清除本地存储的用户id
					plus.storage.removeItem("account");
				})
			},
			
			// 点击顶部我的信息显示侧滑导航，再点击时关闭
			// 判断用户是否登录,如果没有登录侧滑导航不显示，跳转到登录页面
			dragToggle(){
				if(this.userName=="请先登录"){
					// mui(this.$refs.wrap).offCanvas().close();
					mui.openWindow({
						url:"../login/login.html",
						id:"login.html",
						
					});
				}else{
					mui(this.$refs.wrap).offCanvas().toggle();
				}
			}
		}
	})
	
</script>
</html>
